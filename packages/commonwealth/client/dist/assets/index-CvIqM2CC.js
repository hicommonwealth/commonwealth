import"./index-BSfovZ4K.js";import{a as F}from"./index-DiZpu7QE.js";var G=Object.create,z=Object.defineProperty,K=Object.getOwnPropertyDescriptor,L=Object.getOwnPropertyNames,V=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty,U=(t,i)=>()=>(i||t((i={exports:{}}).exports,i),i.exports),Q=(t,i,n,o)=>{if(i&&typeof i=="object"||typeof i=="function")for(let v of L(i))!Y.call(t,v)&&v!==n&&z(t,v,{get:()=>i[v],enumerable:!(o=K(i,v))||o.enumerable});return t},M=(t,i,n)=>(n=t!=null?G(V(t)):{},Q(!t||!t.__esModule?z(n,"default",{value:t,enumerable:!0}):n,t)),I=(t,i,n)=>new Promise((o,v)=>{var b=l=>{try{y(n.next(l))}catch(h){v(h)}},B=l=>{try{y(n.throw(l))}catch(h){v(h)}},y=l=>l.done?o(l.value):Promise.resolve(l.value).then(b,B);y((n=n.apply(t,i)).next())}),$=U((t,i)=>{(function(n,o){typeof t=="object"?i.exports=t=o():typeof define=="function"&&define.amd?define([],o):n.CryptoJS=o()})(t,function(){var n=n||function(o,v){var b=Object.create||function(){function e(){}return function(r){var c;return e.prototype=r,c=new e,e.prototype=null,c}}(),B={},y=B.lib={},l=y.Base=function(){return{extend:function(e){var r=b(this);return e&&r.mixIn(e),(!r.hasOwnProperty("init")||this.init===r.init)&&(r.init=function(){r.$super.init.apply(this,arguments)}),r.init.prototype=r,r.$super=this,r},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var r in e)e.hasOwnProperty(r)&&(this[r]=e[r]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),h=y.WordArray=l.extend({init:function(e,r){e=this.words=e||[],r!=v?this.sigBytes=r:this.sigBytes=e.length*4},toString:function(e){return(e||m).stringify(this)},concat:function(e){var r=this.words,c=e.words,a=this.sigBytes,f=e.sigBytes;if(this.clamp(),a%4)for(var p=0;p<f;p++){var C=c[p>>>2]>>>24-p%4*8&255;r[a+p>>>2]|=C<<24-(a+p)%4*8}else for(var p=0;p<f;p+=4)r[a+p>>>2]=c[p>>>2];return this.sigBytes+=f,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=o.ceil(r/4)},clone:function(){var e=l.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var r=[],c=function(R){var R=R,_=987654321,A=4294967295;return function(){_=36969*(_&65535)+(_>>16)&A,R=18e3*(R&65535)+(R>>16)&A;var x=(_<<16)+R&A;return x/=4294967296,x+=.5,x*(o.random()>.5?1:-1)}},a=0,f;a<e;a+=4){var p=c((f||o.random())*4294967296);f=p()*987654071,r.push(p()*4294967296|0)}return new h.init(r,e)}}),d=B.enc={},m=d.Hex={stringify:function(e){for(var r=e.words,c=e.sigBytes,a=[],f=0;f<c;f++){var p=r[f>>>2]>>>24-f%4*8&255;a.push((p>>>4).toString(16)),a.push((p&15).toString(16))}return a.join("")},parse:function(e){for(var r=e.length,c=[],a=0;a<r;a+=2)c[a>>>3]|=parseInt(e.substr(a,2),16)<<24-a%8*4;return new h.init(c,r/2)}},g=d.Latin1={stringify:function(e){for(var r=e.words,c=e.sigBytes,a=[],f=0;f<c;f++){var p=r[f>>>2]>>>24-f%4*8&255;a.push(String.fromCharCode(p))}return a.join("")},parse:function(e){for(var r=e.length,c=[],a=0;a<r;a++)c[a>>>2]|=(e.charCodeAt(a)&255)<<24-a%4*8;return new h.init(c,r)}},u=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(g.stringify(e)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(e){return g.parse(unescape(encodeURIComponent(e)))}},w=y.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var r=this._data,c=r.words,a=r.sigBytes,f=this.blockSize,p=f*4,C=a/p;e?C=o.ceil(C):C=o.max((C|0)-this._minBufferSize,0);var R=C*f,_=o.min(R*4,a);if(R){for(var A=0;A<R;A+=f)this._doProcessBlock(c,A);var x=c.splice(0,R);r.sigBytes-=_}return new h.init(x,_)},clone:function(){var e=l.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});y.Hasher=w.extend({cfg:l.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){w.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var r=this._doFinalize();return r},blockSize:16,_createHelper:function(e){return function(r,c){return new e.init(c).finalize(r)}},_createHmacHelper:function(e){return function(r,c){return new s.HMAC.init(e,c).finalize(r)}}});var s=B.algo={};return B}(Math);return n})}),X=U((t,i)=>{(function(n,o){typeof t=="object"?i.exports=t=o($()):typeof define=="function"&&define.amd?define(["./core"],o):o(n.CryptoJS)})(t,function(n){return function(o){var v=n,b=v.lib,B=b.WordArray,y=b.Hasher,l=v.algo,h=[],d=[];(function(){function u(r){for(var c=o.sqrt(r),a=2;a<=c;a++)if(!(r%a))return!1;return!0}function w(r){return(r-(r|0))*4294967296|0}for(var s=2,e=0;e<64;)u(s)&&(e<8&&(h[e]=w(o.pow(s,1/2))),d[e]=w(o.pow(s,1/3)),e++),s++})();var m=[],g=l.SHA256=y.extend({_doReset:function(){this._hash=new B.init(h.slice(0))},_doProcessBlock:function(u,w){for(var s=this._hash.words,e=s[0],r=s[1],c=s[2],a=s[3],f=s[4],p=s[5],C=s[6],R=s[7],_=0;_<64;_++){if(_<16)m[_]=u[w+_]|0;else{var A=m[_-15],x=(A<<25|A>>>7)^(A<<14|A>>>18)^A>>>3,S=m[_-2],q=(S<<15|S>>>17)^(S<<13|S>>>19)^S>>>10;m[_]=x+m[_-7]+q+m[_-16]}var T=f&p^~f&C,J=e&r^e&c^r&c,D=(e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22),N=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),j=R+N+T+d[_]+m[_],W=D+J;R=C,C=p,p=f,f=a+j|0,a=c,c=r,r=e,e=j+W|0}s[0]=s[0]+e|0,s[1]=s[1]+r|0,s[2]=s[2]+c|0,s[3]=s[3]+a|0,s[4]=s[4]+f|0,s[5]=s[5]+p|0,s[6]=s[6]+C|0,s[7]=s[7]+R|0},_doFinalize:function(){var u=this._data,w=u.words,s=this._nDataBytes*8,e=u.sigBytes*8;return w[e>>>5]|=128<<24-e%32,w[(e+64>>>9<<4)+14]=o.floor(s/4294967296),w[(e+64>>>9<<4)+15]=s,u.sigBytes=w.length*4,this._process(),this._hash},clone:function(){var u=y.clone.call(this);return u._hash=this._hash.clone(),u}});v.SHA256=y._createHelper(g),v.HmacSHA256=y._createHmacHelper(g)}(Math),n.SHA256})}),Z=U((t,i)=>{(function(n,o){typeof t=="object"?i.exports=t=o($()):typeof define=="function"&&define.amd?define(["./core"],o):o(n.CryptoJS)})(t,function(n){return function(){var o=n,v=o.lib,b=v.WordArray,B=o.enc;B.Base64={stringify:function(l){var h=l.words,d=l.sigBytes,m=this._map;l.clamp();for(var g=[],u=0;u<d;u+=3)for(var w=h[u>>>2]>>>24-u%4*8&255,s=h[u+1>>>2]>>>24-(u+1)%4*8&255,e=h[u+2>>>2]>>>24-(u+2)%4*8&255,r=w<<16|s<<8|e,c=0;c<4&&u+c*.75<d;c++)g.push(m.charAt(r>>>6*(3-c)&63));var a=m.charAt(64);if(a)for(;g.length%4;)g.push(a);return g.join("")},parse:function(l){var h=l.length,d=this._map,m=this._reverseMap;if(!m){m=this._reverseMap=[];for(var g=0;g<d.length;g++)m[d.charCodeAt(g)]=g}var u=d.charAt(64);if(u){var w=l.indexOf(u);w!==-1&&(h=w)}return y(l,h,m)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function y(l,h,d){for(var m=[],g=0,u=0;u<h;u++)if(u%4){var w=d[l.charCodeAt(u-1)]<<u%4*2,s=d[l.charCodeAt(u)]>>>6-u%4*2;m[g>>>2]|=(w|s)<<24-g%4*8,g++}return b.create(m,g)}}(),n.enc.Base64})}),ee=(t=>(t.ParseRedirectResult="magic_oauth_parse_redirect_result",t))(ee||{}),te=(t=>(t.InvalidRequest="invalid_request",t.InvalidClient="invalid_client",t.InvalidScope="invalid_scope",t.InvalidGrant="invalid_grant",t.UnauthorizedClient="unauthorized_client",t.UnsupportedResponseType="unsupported_response_type",t.UnsupportedGrantType="unsupported_grant_type",t.UnsupportedTokenType="unsupported_token_type",t.AccessDenied="access_denied",t.ServerError="server_error",t.TemporarilyUnavailable="temporarily_unavailable",t))(te||{}),re=M(X()),ne=M(Z()),H="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",E=typeof window<"u"&&!!window.crypto,ie=E&&!!window.crypto.subtle;function oe(t){return Array.from(t).map(i=>H[i%H.length]).join("")}function P(t){let i=n=>n.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");if(t instanceof ArrayBuffer){let n=new Uint8Array(t),o=Array.from(n).map(b=>String.fromCharCode(b)).join(""),v=btoa(o);return i(v)}return i(ne.default.stringify(t))}function ae(t){return I(this,null,function*(){if(ie){let i=new TextEncoder().encode(t);return crypto.subtle.digest("SHA-256",i).then(P)}return P((0,re.default)(t))})}function k(t){let i=new Uint8Array(t);if(E)window.crypto.getRandomValues(i);else for(let n=0;n<t;n+=1)i[n]=Math.floor(Math.random()*Math.floor(255));return oe(i)}function se(){return I(this,null,function*(){let t=k(128),i=k(128),n=yield ae(i);return{verifier:i,challenge:n,state:t}})}var he=class extends F.Internal{constructor(){super(...arguments),this.name="oauth",this.config={},this.compat={"magic-sdk":">=2.4.6","@magic-sdk/react-native":!1,"@magic-sdk/react-native-bare":!1,"@magic-sdk/react-native-expo":!1}}loginWithRedirect(t){return this.utils.createPromiEvent(i=>I(this,null,function*(){let{provider:n,query:o}=yield ce.call(this,t);window.location.href=new URL(`/v1/oauth2/${n}/start?${o}`,this.sdk.endpoint).href,i()}))}getRedirectResult(){let t=window.location.search,i=window.location.origin+window.location.pathname;return window.history.replaceState(null,"",i),ue.call(this,t)}},O="oauth_redirect_metadata";function ce(t){return I(this,null,function*(){yield this.utils.storage.removeItem(O);let{provider:i,redirectURI:n,scope:o,loginHint:v}=t,{verifier:b,challenge:B,state:y}=yield se(),l=JSON.stringify({verifier:b,state:y});return yield this.utils.storage.setItem(O,l),{query:[`magic_api_key=${encodeURIComponent(this.sdk.apiKey)}`,`magic_challenge=${encodeURIComponent(B)}`,`state=${encodeURIComponent(y)}`,`platform=${encodeURIComponent("web")}`,o&&`scope=${encodeURIComponent(o.join(" "))}`,n&&`redirect_uri=${encodeURIComponent(n)}`,v&&`login_hint=${encodeURIComponent(v)}`].reduce((h,d)=>d?`${h}&${d}`:h),provider:i,redirectURI:n}})}function ue(t){return this.utils.createPromiEvent((i,n)=>I(this,null,function*(){var o;let v=yield this.utils.storage.getItem(O),{verifier:b,state:B}=JSON.parse(v);this.utils.storage.removeItem(O);let y=this.utils.createJsonRpcRequestPayload("magic_oauth_parse_redirect_result",[t,b,B]),l=yield this.request(y),h=l,d=l;d.error&&n(this.createError(d.error,(o=d.error_description)!=null?o:"An error occurred.",{errorURI:d.error_uri,provider:d.provider})),i(h)}))}export{te as OAuthErrorCode,he as OAuthExtension,ee as OAuthPayloadMethods};
